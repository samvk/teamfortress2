"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function playAudio(e){var a=arguments.length<=1||void 0===arguments[1]?0:arguments[1];setTimeout(function(){e.currentTime=0,e.volume=.1,e.play()},a)}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(a,t,n){return t&&e(a.prototype,t),n&&e(a,n),a}}(),Character=function(){function e(a,t,n,r,i,o,c,s,u){_classCallCheck(this,e),this.name=a,this.clipSize=t,this.ammoCarried=n,this.bulletholeDelay=r,this.radius=i,this.bulletDelay=o,this.reloadTime=c,this.canHeadshot=s,this.points=u}return _createClass(e,[{key:"setValues",value:function(){$(".cursor, .character-icon, .character-screen").attr("data-char",activeChar.name),$("#gundraw").attr("src","audio/"+this.name+"/gundraw.mp3"),$("#gunshot0, #gunshot1").attr("src","audio/"+this.name+"/gunshot.mp3"),$("#reload").attr("src","audio/"+this.name+"/reload.mp3"),$("#no-ammo0, #no-ammo1").attr("src","audio/"+this.name+"/no-ammo.mp3"),$("#no").attr("src","audio/"+this.name+"/no.mp3")}},{key:"setSpeak",value:function(){var e=Math.floor(3*Math.random());$("#speak").attr("src","audio/"+this.name+"/speak"+e+".mp3")}}]),e}(),char={scout:new Character("scout",6,32,0,.4,550,1400,!1,10),soldier:new Character("soldier",4,20,850,0,2e3,2100,!1,20),pyro:new Character("pyro",200,0,0,0,100,300,!1,2),demoman:new Character("demoman",4,16,540,.4,1450,2050,!1,20),heavy:new Character("heavy",200,0,0,1.5,100,1650,!1,2),engy:new Character("engy",6,32,0,.4,880,1600,!1,10),medic:new Character("medic",40,150,0,.2,120,1200,!1,2),sniper:new Character("sniper",1,25,0,0,500,1200,!0,10),spy:new Character("spy",6,24,0,.2,770,1890,!0,4)},Cookie=function(){function e(a){_classCallCheck(this,e),this.cname=a}return _createClass(e,[{key:"getCookie",value:function(){for(var e=this.cname+"=",a=document.cookie.split(";"),t=0;t<a.length;t++){for(var n=a[t];" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(e))return n.substring(e.length,n.length)}return""}},{key:"setCookie",value:function(e){var a=arguments.length<=1||void 0===arguments[1]?365:arguments[1],t=new Date;t.setTime(t.getTime()+24*a*60*60*1e3);var n="expires="+t.toUTCString();document.cookie=this.cname+"="+e+"; "+n}}]),e}(),charNames=function(){var e=[];for(var a in char)e.push(a);return e}(),activeChar=char.scout,screenOpen="menu-screen",mouseHeldDown=void 0,xPosition=void 0,yPosition=void 0,headHovering=void 0,highscore=[],pointCount=void 0,oldHighscore=void 0,GUN=function(){function r(){$(".clip").text(a),$(".ammo-carried").text(t)}var e=!0,a=void 0,t=void 0,n=void 0;return{resetAmmo:function(){e=!1,a=activeChar.clipSize,t=activeChar.ammoCarried,n=a+t,r(),activeChar.setSpeak()},reloading:function(){function o(){n>=activeChar.clipSize?(t-=activeChar.clipSize-a,a=activeChar.clipSize):(a+=t,t=0)}var i=a!==activeChar.clipSize&&0!==t&&!e;i&&(clearInterval(mouseHeldDown),e=!0,setTimeout(function(){o(),r(),e=!1},activeChar.reloadTime),playAudio($("#reload")[0]))},shooting:function(){function t(){$(".cursor").addClass("is-shooting").one("webkitTransitionEnd otransitionend msTransitionEnd transitionend",function(){$(this).removeClass("is-shooting")})}function i(){var e={x:function(){return Math.random()*(2*activeChar.radius)-activeChar.radius},y:function i(e){var i=Math.sqrt(Math.pow(activeChar.radius,2)-Math.pow(e,2));return(Math.random()*(2*i)-i)*(16/9)}};if(n>0){var a=e.x(),t=e.y(a);$('<li class="bullethole" data-char='+activeChar.name+"></li>").appendTo(".bulletholes").css({left:"calc("+xPosition+"px - "+a+"%)",top:"calc("+yPosition+"px - "+t+"%)"}).delay(activeChar.bulletholeDelay).fadeIn(0),activeChar.canHeadshot&&headHovering&&($('<p class="crit">Critical<br>Hit!!!</p>').appendTo(".headshots").css({left:xPosition,top:yPosition}),pointCount+=4,playAudio($("#headshot")[0],200))}}function o(){n--,e=!0,setTimeout(function(){e=!1},activeChar.bulletDelay);var t=0>n?"no-ammo":"gunshot";playAudio($("#"+t+Math.abs(n)%2)[0]),-2>n&&playAudio($("#no")[0],50),n>=0&&(a--,pointCount+=activeChar.points,0>=a&&(clearInterval(mouseHeldDown),setTimeout(function(){GUN.reloading()},activeChar.bulletDelay)),pointCount>oldHighscore&&(highscore[activeChar.name].setCookie(pointCount),""!==oldHighscore&&$(".new-highscore--hud").addClass("is-visible")))}function c(){0===n&&($(".crate").addClass("is-visible"),playAudio($("#speak")[0],500),activeChar===char.heavy&&playAudio($("#wind-down")[0]))}function s(){0!==activeChar.ammoCarried&&$(".reload-line").addClass("is-visible")}e||(t(),i(),o(),c(),s(),r())}}}();$(document).ready(function(){$(window).load(function(){var e=!0,a=!1,t=void 0;try{for(var r,n=charNames[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var i=r.value;highscore[i]=new Cookie(i+"highscore");var o=highscore[i].getCookie()||"0";$("[data-highscore="+i+"]").text(o)}}catch(c){a=!0,t=c}finally{try{!e&&n["return"]&&n["return"]()}finally{if(a)throw t}}var s=new Cookie("lastPlayed"),u=s.getCookie(),l=(new Date).toDateString(),h="";h=u===l?"Today":u||"Welcome new user!",$(".last-played-message").text(h),s.setCookie(l)}),$("button").mousedown(function(){playAudio($("#button")[0])}),$(".welcome-screen__button, .map-screen__button").click(function(){$(this).parent().remove()}),$(".map-screen__button").click(function(){screenOpen="character-screen"}),$(".character-screen__button, [data-choose-char]").click(function(){activeChar.setValues(),GUN.resetAmmo(),$(".bullethole, .crit, .reload-line.is-visible").remove(),$(".crate, .new-highscore--hud").removeClass("is-visible"),$(".ammo-carried").css("opacity",activeChar.ammoCarried&&1),oldHighscore=highscore[activeChar.name].getCookie(),pointCount=0,screenOpen="gamescreen",$(".character-screen").hide(),playAudio($("#gundraw")[0],300)}),$(".go-fullscreen").click(function(){var e=document.body;(e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||function(){}).call(e)}),$("[data-choose-char]").mouseenter(function(){var e=$(this).data("choose-char");!function a(e){if("random"===e){for(var t=activeChar;activeChar===t;){var n=Math.floor(Math.random()*charNames.length);a([charNames[n]])}$(".character-screen").attr("data-char","random")}else activeChar=char[e],$(".character-screen").attr("data-char",activeChar.name),playAudio($("#hover")[0])}(e)}),$(document).keydown(function(e){var a=parseInt(e.which,10);if("menu-screen"===screenOpen||"character-screen"===screenOpen)switch(a){case 13:$("button").first().focus().trigger("mousedown").trigger("click")}if("character-screen"===screenOpen)switch(a){case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 48:var t=charNames[a-49]||"random";$("[data-choose-char="+t+"]").trigger("mouseenter")}else if("gamescreen"===screenOpen)switch(a){case 82:GUN.reloading();break;case 188:$(".change-char__button").trigger("mousedown").trigger("click");break;case 70:$(".go-fullscreen").trigger("mousedown").trigger("click")}}),$(document).mousemove(function(e){xPosition=e.pageX,yPosition=e.pageY-$(".gamescreen").offset().top,$(".cursor").finish().css({top:yPosition,left:xPosition})}),$("[data-headshot]").hover(function(){headHovering=!headHovering}),$(".gamescreen").mousedown(function(e){1===e.which&&(activeChar===char.heavy?playAudio($("#wind-up")[0]):GUN.shooting(),clearInterval(mouseHeldDown),mouseHeldDown=setInterval(GUN.shooting,activeChar.bulletDelay+50))}).mouseup(function(e){1===e.which&&(clearInterval(mouseHeldDown),activeChar===char.heavy&&playAudio($("#wind-down")[0]))}).mouseleave(function(){clearInterval(mouseHeldDown)}),$(document).blur(function(){clearInterval(mouseHeldDown)}),$(".crate, .change-char__button, .fullscreen-icon").on("mousedown click",function(e){e.stopPropagation()}).hover(function(){$(".cursor").toggle().removeClass("is-shooting")}),$(".crate").click(function(){$(this).removeClass("is-visible"),setTimeout(function(){GUN.resetAmmo()},600+activeChar.reloadTime),playAudio($("#resupply")[0]),playAudio($("#reload")[0],600)}),$(".change-char__button").click(function(e){$(".character-screen").show(),screenOpen="character-screen"}),$(document).on("contextmenu",function(){return!1})});